<form class="form-table form-search">
  <!-- Level 1 -->
  <div class="form-row grid">
    <!-- Brand -->
    <div class="form-col lg:col-4 sm:col-12 col-12">
      <div class="form-row grid">
        <div class="form-col col-fixed">
          <div class="form-label">
            <label class="txt">Brand</label>
          </div>
        </div>

        <div class="form-col col">
          <div class="form-input">
            <p-autoComplete
              [(ngModel)]="formValue.brand"
              [suggestions]="soaControlSetupByItemService.filteredBrand"
              (completeMethod)="
                soaControlSetupByItemService.filterBrand($event)
              "
              [minLength]="1"
              field="label"
              [style]="{ width: '100%' }"
              (onBlur)="
                formValue.brand &&
                  (formValue.brand.value ?? (formValue.brand = null))
              "
              [ngModelOptions]="{ standalone: true }"
              (ngModelChange)="onBrandSelect()"
              placeholder="{{ 'Input.PlaceHolder.PleaseKeyIn' | translate }}"
              [showClear]="true"
              (onClear)="formValue.brand = null"
            >
            </p-autoComplete>
          </div>
        </div>
      </div>
    </div>

    <!-- Ctg1 -->
    <div class="form-col lg:col-4 sm:col-12 col-12">
      <div class="form-row grid">
        <div class="form-col col-fixed">
          <div class="form-label">
            <label class="txt">Ctg1</label>
          </div>
        </div>

        <div class="form-col col">
          <div class="form-select">
            <p-dropdown
              [options]="soaControlSetupByItemService.filteredCtg1"
              appendTo="body"
              placeholder="{{
                'DropDown.PlaceHolder.PleaseChoose' | translate
              }}"
              [(ngModel)]="formValue.ctg1"
              (onBlur)="formValue.ctg1 ?? (formValue.ctg1 = null)"
              [disabled]="!formValue.brand || !formValue.brand.value"
              [ngModelOptions]="{ standalone: true }"
              [style]="{ width: '100%' }"
              [filter]="true"
              (ngModelChange)="onCtg1Select()"
              [showClear]="true"
              (onClear)="formValue.ctg1 = null"
            >
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>

    <!-- Ctg2 -->
    <div class="form-col lg:col-4 sm:col-12 col-12">
      <div class="form-row grid">
        <div class="form-col col-fixed">
          <div class="form-label">
            <label class="txt">Ctg2</label>
          </div>
        </div>

        <div class="form-col col">
          <div class="form-select">
            <p-dropdown
              [options]="soaControlSetupByItemService.filteredCtg2"
              appendTo="body"
              placeholder="{{
                'DropDown.PlaceHolder.PleaseChoose' | translate
              }}"
              [(ngModel)]="formValue.ctg2"
              (onBlur)="formValue.ctg2 ?? (formValue.ctg2 = null)"
              [ngModelOptions]="{ standalone: true }"
              [style]="{ width: '100%' }"
              [filter]="true"
              [disabled]="
                !formValue.brand || !formValue.brand.value || !formValue.ctg1
              "
              [showClear]="true"
              (onClear)="formValue.ctg2 = null"
            >
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Level 2 -->
  <div class="form-row grid">
    <!-- ECCN -->
    <div class="form-col lg:col-4 sm:col-12 col-12">
      <div class="form-row grid">
        <div class="form-col col-fixed">
          <div class="form-label">
            <label class="txt">ECCN</label>
          </div>
        </div>

        <div class="form-col col">
          <div class="form-input">
            <p-dropdown
              [options]="soaControlSetupByItemService.filteredECCN"
              appendTo="body"
              placeholder="{{
                'DropDown.PlaceHolder.PleaseChoose' | translate
              }}"
              [(ngModel)]="formValue.eccn"
              (onBlur)="formValue.eccn ?? (formValue.eccn = null)"
              [ngModelOptions]="{ standalone: true }"
              [style]="{ width: '100%' }"
              [filter]="true"
              [showClear]="true"
              (onClear)="formValue.eccn = null"
            >
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>

    <!-- Item -->
    <div class="form-col lg:col-4 sm:col-12 col-12">
      <div class="form-row grid">
        <div class="form-col col-fixed">
          <div class="form-label">
            <label class="txt">Item No</label>
          </div>
        </div>

        <div class="form-col col">
          <div class="form-input">
            <p-autoComplete
              [(ngModel)]="formValue.item"
              [suggestions]="soaControlSetupByItemService.cacheFilterItem"
              (completeMethod)="
                soaControlSetupByItemService.filterItemforCache($event)
              "
              [minLength]="1"
              field="label"
              [style]="{ width: '100%' }"
              (onBlur)="
                formValue.item &&
                  (formValue.item.value ?? (formValue.item = null))
              "
              [ngModelOptions]="{ standalone: true }"
              placeholder="{{ 'Input.PlaceHolder.PleaseKeyIn' | translate }}"
              [showClear]="true"
              appendTo="body"
              [showClear]="true"
              (onClear)="formValue.item = null"
            >
            </p-autoComplete>
          </div>
        </div>
      </div>
    </div>

    <!-- 有效/無效 -->
    <div class="form-col lg:col-4 sm:col-12 col-12">
      <div class="form-row grid">
        <div class="form-col col-fixed">
          <div class="form-label">
            <label class="txt">{{
              "SoaControlSetup.Label.Flag" | translate
            }}</label>
          </div>
        </div>

        <div class="form-col col">
          <div class="form-select">
            <p-dropdown
              [options]="soaControlSetupByItemService.flagOptionsWithDefault"
              appendTo="body"
              placeholder="{{
                'DropDown.PlaceHolder.PleaseChoose' | translate
              }}"
              [(ngModel)]="formValue.flag"
              name="flag"
              [ngModelOptions]="{ standalone: true }"
            >
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Level 3 -->
  <div class="form-row grid">
    <!-- 有效/無效 -->
    <div class="form-col lg:col-4 sm:col-12 col-12">
      <div class="form-row grid">
        <div class="form-col col-fixed">
          <div class="form-label">
            <label class="txt">{{
              "SOA.Label.SpecialApproval" | translate
            }}</label>
          </div>
        </div>

        <div class="form-col col">
          <div class="form-select">
            <p-dropdown
              [options]="soaControlSetupByItemService.flagOptionsWithDefault"
              appendTo="body"
              placeholder="{{
                'DropDown.PlaceHolder.PleaseChoose' | translate
              }}"
              [(ngModel)]="formValue.specialApproval"
              name="specialApproval"
              [ngModelOptions]="{ standalone: true }"
            >
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 按鈕 -->
  <div class="btn-container">
    <!--重設-->
    <button
      pButton
      type="button"
      label="{{ 'Button.Label.Reset' | translate }}"
      class="btn-secondary"
      (click)="resetOnClick()"
    ></button>
    <!--查詢-->
    <button
      pButton
      type="button"
      label="{{ 'Button.Label.Query' | translate }}"
      (click)="queryOnClick('S');tableStatusKeepService.resetPageEvent()"
      *ngIf="permissions.includes('view')"
    ></button>
    <!--下載-->
    <button
      pButton
      type="button"
      label="{{ 'Button.Label.Download' | translate }}"
      class="btn-teal"
      (click)="queryOnClick('E')"
      *ngIf="permissions.includes('view')"
    ></button>
  </div>
</form>

<!-- Table -->
<app-common-data-table-viewer
  [data]="tableData.getValue()"
  [tableCols]="tableCols"
  [tableSettings]="dataTableSettings"
  [totalRecords]="totalRecords"
  [deleteKeyBeforeReturn]="false"
  [cleanSelected]="cleanTable"
  (isAddItemActive)="soaDialogOpen()"
  (outputAfterDeletedData)="onAfterModifiedDataCallback($event)"
  (outputTargetData)="soaDialogOpen($event)"
  (outputTableStatus)="getTableStatus($event)"
  (outputSelectedData)="onSelectedDataHandler($event)"
  (updateSignal)="updateSignalHandler()"
>
</app-common-data-table-viewer>

<!-- Dialog -->
<app-soa-control-by-item-dialog
  [showDialog]="showDialog"
  (closeDialog)="soaDialogClose()"
  [editObj]="editObj"
  (saveEmitter)="getDialogInfo($event)"
>
</app-soa-control-by-item-dialog>

<!-- 訊息dialog -->
<app-common-notice-check-dialog
  [settingParams]="noticeCheckDialogParams"
  [contentList]="noticeContentList"
>
</app-common-notice-check-dialog>

<app-soa-control-setup-by-item-update-dialog
  [settingParams]="updateDialogParams"
  (outputUpdateInfo)="onUpdateInfoHandler($event)"
></app-soa-control-setup-by-item-update-dialog>

<p-progressSpinner *ngIf="showSpinner"></p-progressSpinner>
